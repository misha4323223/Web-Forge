# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Gigachat AI –≤ MP.WebStudio

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 20 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Yandex Cloud

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏](#–æ–±–∑–æ—Ä-—Ç–µ–∫—É—â–µ–π-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
3. [API Flow](#api-flow)
4. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ç–æ–∫–µ–Ω—ã](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-—Ç–æ–∫–µ–Ω—ã)
5. [–ú–æ–¥–µ–ª–∏ Gigachat](#–º–æ–¥–µ–ª–∏-gigachat)
6. [–ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è](#–ø—Ä–æ–±–ª–µ–º—ã-–∏-—Ä–µ—à–µ–Ω–∏—è)
7. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Yandex Cloud](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–¥–ª—è-yandex-cloud)
8. [Roadmap —É–ª—É—á—à–µ–Ω–∏–π](#roadmap-—É–ª—É—á—à–µ–Ω–∏–π)

---

## üéØ –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

**Frontend (React + TypeScript)**
- –§–∞–π–ª: `client/src/components/ChatWidget.tsx`
- –ü–ª–∞–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ AI –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è)
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ (640x600px)
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (—Å—Ç–∏—Ä–∞–µ—Ç—Å—è –ø—Ä–∏ F5)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ò—Å—Ç–æ—Ä–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è"
- –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—É–ª—å—Å–∏—Ä—É—é—â–∏–µ —Ç–æ—á–∫–∏)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞–≤–∞, AI —Å–ª–µ–≤–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –≤—ã–≤–æ–¥–æ–º —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–∫–∏

**Backend (Express.js + Node.js)**

*Replit (`server/routes.ts`, —Å—Ç—Ä–æ–∫–∏ 759-878):*
- Endpoint: `POST /api/giga-chat`
- –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OAuth 2.0 flow
- –ü–æ–ª—É—á–µ–Ω–∏–µ access_token –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (1-2000 —Å–∏–º–≤–æ–ª–æ–≤)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ (8 —à–∞–≥–æ–≤)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏

*Yandex Cloud (`yandex-cloud-function/index-ydb.js`, —Å—Ç—Ä–æ–∫–∏ 3140-3306):*
- –§—É–Ω–∫—Ü–∏—è `handleGigaChat(body, headers)`
- –ò–¥–µ–Ω—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `fetch` API
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å Replit –≤–µ—Ä—Å–∏–µ–π
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—É—Ç–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏

### –¢–µ–∫—É—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
GIGACHAT_KEY = "ZDY2ODkxYjUtZDBkNi00MTM4LWJjZDUtMzBkODc2N2NlNjk5OmM0YjkxZjNlLTM2YTYtNGEwNS1iODk5LWQyNGY1ODUxOGU1Yg=="
GIGACHAT_SCOPE = "GIGACHAT_API_PERS"
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (React)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ChatWidget.tsx   ‚îÇ Input ‚Üî Messages ‚îÇ AI Chat Modal Dialog ‚îÇ
‚îÇ (182 —Å—Ç—Ä–æ–∫–∏)     ‚îÇ (History in RAM) ‚îÇ (Gradient Button)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ POST /api/giga-chat
         ‚îÇ { message: string }
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             BACKEND LAYER (2 –≤–∞—Ä–∏–∞–Ω—Ç–∞)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ REPLIT (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):                                        ‚îÇ
‚îÇ ‚Ä¢ server/routes.ts ‚Üí /api/giga-chat                        ‚îÇ
‚îÇ ‚Ä¢ httpsRequest() –¥–ª—è HTTPS –∑–∞–ø—Ä–æ—Å–æ–≤                         ‚îÇ
‚îÇ ‚Ä¢ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: console.log() ‚úÖ                            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ YANDEX CLOUD (–ø—Ä–æ–¥–∞–∫—à–µ–Ω):                                   ‚îÇ
‚îÇ ‚Ä¢ yandex-cloud-function/index-ydb.js ‚Üí handleGigaChat()   ‚îÇ
‚îÇ ‚Ä¢ fetch API (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Node.js)                        ‚îÇ
‚îÇ ‚Ä¢ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: console.log() + Cloud Logging ‚úÖ            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îò
         ‚îÇ                                                  ‚îÇ
         ‚îú‚îÄ 1Ô∏è‚É£ Validate message                              ‚îÇ
         ‚îú‚îÄ 2Ô∏è‚É£ Check GIGACHAT_KEY                            ‚îÇ
         ‚îÇ                                                  ‚îÇ
         ‚ñº                                                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         SBERBANK OAUTH (ngw.devices.sberbank.ru)             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ POST /api/v2/oauth                                         ‚îÇ
‚îÇ Headers: Basic Auth (GIGACHAT_KEY in base64)              ‚îÇ
‚îÇ Body: scope=GIGACHAT_API_PERS                             ‚îÇ
‚îÇ Response: { access_token, expires_in, token_type }        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     GIGACHAT API (gigachat.devices.sbercloud.ru)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ POST /api/v1/chat/completions                             ‚îÇ
‚îÇ Headers: Bearer {access_token}                             ‚îÇ
‚îÇ Body: {                                                    ‚îÇ
‚îÇ   model: "GigaChat",                                       ‚îÇ
‚îÇ   messages: [{ role: "user", content: "..." }],           ‚îÇ
‚îÇ   temperature: 0.7,                                        ‚îÇ
‚îÇ   max_tokens: 1000                                         ‚îÇ
‚îÇ }                                                          ‚îÇ
‚îÇ                                                            ‚îÇ
‚îÇ Response: { choices[0].message.content }                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           RESPONSE TO FRONTEND                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ { success: true, response: "AI answer..." }               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ API Flow (–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

### –§–∞–∑–∞ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ)

```javascript
// ChatWidget.tsx (—Å—Ç—Ä–æ–∫–∞ 37)
const response = await apiRequest("POST", "/api/giga-chat", { 
  message: userMessage 
});
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –≤–∏–¥–µ JSON: `{ message: "–ü—Ä–∏–≤–µ—Ç!" }`
2. –ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ `isLoading = true`)
3. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

---

### –§–∞–∑–∞ 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**Replit:**
```typescript
// server/routes.ts, —Å—Ç—Ä–æ–∫–∏ 763-773
if (!message || typeof message !== 'string' || message.trim().length === 0) {
  return res.status(400).json({
    success: false,
    response: '–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ',
  });
}
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø—É—Å—Ç–æ
- ‚úÖ –¢–∏–ø = string
- ‚úÖ –î–ª–∏–Ω–∞ ‚â§ 2000 —Å–∏–º–≤–æ–ª–æ–≤ (–≤ Cloud Function)
- ‚úÖ –ï—Å—Ç—å GIGACHAT_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

### –§–∞–∑–∞ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞

**Endpoint:** `https://ngw.devices.sberbank.ru:9443/api/v2/oauth`

**Replit –∫–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 794-803):**
```typescript
const authResponse = await httpsRequest('https://ngw.devices.sberbank.ru:9443/api/v2/oauth', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/x-www-form-urlencoded',
    'Accept': 'application/json',
    'Authorization': `Basic ${gigachatKey}`,  // ‚ö†Ô∏è –í–ê–ñ–ù–û: Basic, –Ω–µ Bearer!
    'RqUID': crypto.randomUUID(),
  },
  body: `scope=${encodeURIComponent(gigachatScope)}`,
});
```

**Yandex Cloud –≤–µ—Ä—Å–∏—è (—Å—Ç—Ä–æ–∫–∏ 3194-3203):**
```javascript
authResponse = await fetch('https://ngw.devices.sberbank.ru:9443/api/v2/oauth', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/x-www-form-urlencoded',
    'Accept': 'application/json',
    'Authorization': `Basic ${gigachatKey}`,
    'RqUID': crypto.randomUUID(),
  },
  body: authBody,
});
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üî¥ **–¢–û–õ–¨–ö–û Basic auth**, –Ω–µ Bearer!
- üî¥ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** `Accept: application/json`
- üî¥ **RqUID** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å UUID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞)
- üü¢ **–û—Ç–≤–µ—Ç:** `{ access_token, expires_in, token_type }`

**–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞:** 30 –º–∏–Ω—É—Ç (–æ–±—ã—á–Ω–æ)

---

### –§–∞–∑–∞ 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ GigaChat API

**Endpoint:** `https://gigachat.devices.sbercloud.ru/api/v1/chat/completions`

**–ö–æ–¥ (Replit, —Å—Ç—Ä–æ–∫–∏ 831-843):**
```typescript
const chatResponse = await httpsRequest('https://gigachat.devices.sbercloud.ru/api/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${accessToken}`,  // ‚úÖ Bearer –¥–ª—è chat API!
  },
  body: JSON.stringify({
    model: 'GigaChat',
    messages: [{ role: 'user', content: message }],
    temperature: 0.7,
    max_tokens: 1000,
  }),
});
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|---------|
| `model` | GigaChat | –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å |
| `temperature` | 0.7 | –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ (0-1, –≤—ã—à–µ = –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ–µ) |
| `max_tokens` | 1000 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ (–≤ —Ç–æ–∫–µ–Ω–∞—Ö) |
| `top_p` | (–Ω–µ —É–∫–∞–∑–∞–Ω) | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.9 |

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—à–Ω—ã–π):**
```json
{
  "choices": [
    {
      "message": {
        "content": "–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º...",
        "role": "assistant"
      },
      "finish_reason": "stop",
      "index": 0
    }
  ],
  "usage": {
    "prompt_tokens": 10,
    "completion_tokens": 50,
    "total_tokens": 60
  }
}
```

---

### –§–∞–∑–∞ 5: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫–ª–∏–µ–Ω—Ç—É

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "response": "–ü—Ä–∏–≤–µ—Ç! –Ø –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º..."
}
```

**–û—à–∏–±–∫–∞:**
```json
{
  "success": false,
  "response": "–û—à–∏–±–∫–∞: Auth error: 401 - Invalid credentials"
}
```

**Frontend –æ–±—Ä–∞–±–æ—Ç–∫–∞ (ChatWidget.tsx, —Å—Ç—Ä–æ–∫–∏ 54-67):**
```typescript
if (data.success) {
  setMessages((prev) => [
    ...prev,
    { role: "assistant", content: data.response },
  ]);
} else {
  setMessages((prev) => [
    ...prev,
    {
      role: "assistant",
      content: data.response || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
    },
  ]);
}
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ç–æ–∫–µ–Ω—ã

### GIGACHAT_KEY - –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–§–æ—Ä–º–∞—Ç:** Base64-encoded `client_id:client_secret`

```
–û—Ä–∏–≥–∏–Ω–∞–ª: d66891b5-d0d6-4138-bcd5-30d8767ce699:c4b91f3e-36a6-4a05-b899-d24f58518e5b
Base64:   ZDY2ODkxYjUtZDBkNi00MTM4LWJjZDUtMzBkODc2N2NlNjk5OmM0YjkxZjNlLTM2YTYtNGEwNS1iODk5LWQyNGY1ODUxOGU1Yg==
```

**–ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å:**
1. https://developers.sber.ru/studio/workspaces/
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç ‚Üí GigaChat API
3. Settings ‚Üí API Keys
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å "Authorization key"

### –¢–æ–∫–µ–Ω—ã OAuth vs API —Ç–æ–∫–µ–Ω—ã

| –¢–∏–ø | –û–±–ª–∞—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ | –ö–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å |
|-----|----------------------|-------------|-------------|
| **Authorization Key** | –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è OAuth —Ç–æ–∫–µ–Ω–∞ | –ù–µ —Å—Ö–æ–¥–∏—Ç (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π) | Header: `Basic {key}` |
| **Access Token** | –î–ª—è –≤—ã–∑–æ–≤–∞ GigaChat API | ~30 –º–∏–Ω | Header: `Bearer {token}` |
| **Session Token** | Admin auth (Replit + Cloud) | 24 —á–∞—Å–∞ | Cookie + Header |

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ –∑–∞—â–∏—Ç–∞

**üî¥ –ü—Ä–æ–±–ª–µ–º–∞:** GIGACHAT_KEY —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–≤–∏–¥–∏–º –≤ –∫–æ–¥–µ)

**‚úÖ –†–µ—à–µ–Ω–∏–µ:**
- –ù–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞—Ç—å –∫–ª—é—á –≤ GitHub (–∏—Å–ø–æ–ª—å–∑—É–µ–º .env)
- –ù–∞ Yandex Cloud: —Å–µ–∫—Ä–µ—Ç—ã –≤ Settings ‚Üí Variables
- –ù–∞ Replit: –∏—Å–ø–æ–ª—å–∑—É–µ–º Secrets tab
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π –∫–ª—é—á (—Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω—É: `key?.length`)

**üî¥ –ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞)

**‚úÖ –†–µ—à–µ–Ω–∏–µ (–±—É–¥—É—â–µ–µ):**
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ –ø–∞–º—è—Ç–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π expiration
- Redis –¥–ª—è –∫–µ—à–∞ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (–µ—Å–ª–∏ –±—É–¥–µ—Ç)

---

## ü§ñ –ú–æ–¥–µ–ª–∏ Gigachat

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–¥–µ–∫–∞–±—Ä—å 2025)

| –ú–æ–¥–µ–ª—å | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ | –°–∫–æ—Ä–æ—Å—Ç—å | –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | –î–ª—è –∫–æ–≥–æ |
|--------|-----------|---------|------------------|----------|
| **GigaChat** | –û–±—â–∏–µ –∑–∞–¥–∞—á–∏, —Ä–µ—Ä–∞–π—Ç–∏–Ω–≥ | –ë—ã—Å—Ç—Ä–æ ‚ö° | 128K | –ë–∞–∑–æ–≤–æ–µ |
| **GigaChat-Pro** | + –ê–Ω–∞–ª–∏–∑, —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ | –°—Ä–µ–¥–Ω–µ | 128K | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ |
| **GigaChat-Max** | + –§–∏–∑–∏–∫–∞, —Ö–∏–º–∏—è, –º–∞—Ç–∞–Ω | –ú–µ–¥–ª–µ–Ω–Ω–æ | 128K | –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã |
| **GigaChat-Image** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ | –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ | - | –î–∏–∑–∞–π–Ω–µ—Ä—ã |

**–¢–µ–∫—É—â–∏–π –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:** `GigaChat` (–±–∞–∑–æ–≤–∞—è, —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å)

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```javascript
{
  model: "GigaChat",           // –ö–∞–∫—É—é –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  temperature: 0.7,            // 0-1: –≤—ã—à–µ = –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ–µ
  max_tokens: 1000,            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞
  top_p: 0.9,                  // (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) Sampling diversity
  top_k: 50,                   // (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) Top-K filtering
  repetition_penalty: 1.0      // (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ç–æ—Ä—ã
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —á–∞—Ç–∞:**
- `temperature: 0.7` ‚úÖ (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ª–æ–≥–∏–∫–æ–π –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å—é)
- `max_tokens: 1000` ‚úÖ (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ—Ç–≤–µ—Ç–∞)
- –î–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤: `0.8-0.9`
- –î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: `0.3-0.5`

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Auth error: 401 - Invalid credentials"

**–ü—Ä–∏—á–∏–Ω–∞:** 
- GIGACHAT_KEY –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- GIGACHAT_KEY –∏—Å—Ç—ë–∫ (—Ä–µ–¥–∫–æ)
- –û–ø–µ—á–∞—Ç–∫–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–ª–∏–Ω—É –∫–ª—é—á–∞
echo -n "ZDY2ODkxYjUtZDBkNi00MTM4LWJjZDUtMzBkODc2N2NlNjk5OmM0YjkxZjNlLTM2YTYtNGEwNS1iODk5LWQyNGY1ODUxOGU1Yg==" | wc -c
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 88 —Å–∏–º–≤–æ–ª–æ–≤

# –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á –Ω–∞ https://developers.sber.ru/studio/workspaces/
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–û—à–∏–±–∫–∞: Invalid auth response format"

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `Content-Type` –≤ –æ—Ç–≤–µ—Ç–µ
- –û—Ç–≤–µ—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–µ JSON

**–†–µ—à–µ–Ω–∏–µ (—É–∂–µ –≤ –∫–æ–¥–µ):**
```javascript
const contentType = response.headers.get("content-type");
if (!contentType?.includes("application/json")) {
  throw new Error("Invalid content-type");
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Timeout –Ω–∞ Yandex Cloud Function

**–ü—Ä–∏—á–∏–Ω–∞:** 
- –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∞ > 60 —Å–µ–∫—É–Ω–¥
- GigaChat API –º–µ–¥–ª–µ–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (–¥–æ 600 —Å–µ–∫)
- –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à –æ—Ç–≤–µ—Ç–æ–≤ (redis/memcached)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ª—ë–≥–∫—É—é –º–æ–¥–µ–ª—å

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π"

**–ü—Ä–∏—á–∏–Ω–∞:** 
- Cold start –Ω–∞ Yandex Cloud Function
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞ YDB
- –ü–æ–ª—É—á–µ–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å OAuth —Ç–æ–∫–µ–Ω
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Provisioned Concurrency (–ø–ª–∞—Ç–Ω–æ)

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Yandex Cloud

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:**
- Endpoint `/api/giga-chat` –µ—Å—Ç—å –≤ `handleGigaChat()`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É Replit –∏ Cloud

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**

### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω (–º–µ–¥–ª–µ–Ω–Ω–æ)

**–†–µ—à–µ–Ω–∏–µ –¥–ª—è Cloud Function:**

```javascript
// –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ index-ydb.js
let gigaChatTokenCache = {
  token: null,
  expiresAt: 0
};

async function getGigaChatToken() {
  const now = Date.now();
  
  // –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—â—ë –≤–∞–ª–∏–¥–Ω—ã–π, –≤–µ—Ä–Ω—É—Ç—å –∏–∑ –∫–µ—à–∞
  if (gigaChatTokenCache.token && gigaChatTokenCache.expiresAt > now) {
    console.log("‚úÖ Using cached GigaChat token");
    return gigaChatTokenCache.token;
  }
  
  // –ò–Ω–∞—á–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
  const gigachatKey = process.env.GIGACHAT_KEY;
  const gigachatScope = process.env.GIGACHAT_SCOPE || 'GIGACHAT_API_PERS';
  const authBody = `scope=${encodeURIComponent(gigachatScope)}`;
  
  const authResponse = await fetch('https://ngw.devices.sberbank.ru:9443/api/v2/oauth', {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/x-www-form-urlencoded',
      'Accept': 'application/json',
      'Authorization': `Basic ${gigachatKey}`,
      'RqUID': crypto.randomUUID(),
    },
    body: authBody,
  });
  
  const authData = await authResponse.json();
  const accessToken = authData.access_token;
  const expiresIn = authData.expires_in || 1800; // 30 –º–∏–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à —Å –±—É—Ñ–µ—Ä–æ–º 1 –º–∏–Ω—É—Ç–∞
  gigaChatTokenCache = {
    token: accessToken,
    expiresAt: now + (expiresIn - 60) * 1000
  };
  
  console.log("üÜï New GigaChat token cached");
  return accessToken;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ handleGigaChat:
const accessToken = await getGigaChatToken();
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ 300-500ms –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### 2. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

**–î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É:**

```javascript
async function fetchWithRetry(url, options, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url, options);
      if (response.ok) return response;
      
      // Retry –Ω–∞ 5xx –æ—à–∏–±–∫–∞—Ö
      if (response.status >= 500 && i < maxRetries - 1) {
        await new Promise(r => setTimeout(r, 1000 * (i + 1))); // –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff
        continue;
      }
      throw new Error(`HTTP ${response.status}`);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(r => setTimeout(r, 1000 * (i + 1)));
    }
  }
}
```

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –¥–ª—è Cloud Logging

```javascript
// –í–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö console.log():
const logRequest = (step, message, data = {}) => {
  console.log(JSON.stringify({
    timestamp: new Date().toISOString(),
    step,
    message,
    ...data
  }));
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
logRequest("GIGA_AUTH_START", "Requesting OAuth token", {
  scope: gigachatScope,
  keyLength: gigachatKey?.length
});
```

### 4. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

```javascript
const gigaChatMetrics = {
  totalRequests: 0,
  successfulRequests: 0,
  failedRequests: 0,
  averageResponseTime: 0,
  tokenReuses: 0,
  
  recordRequest(duration, success = true) {
    this.totalRequests++;
    if (success) {
      this.successfulRequests++;
    } else {
      this.failedRequests++;
    }
    console.log(`üìä Metrics: ${this.successfulRequests}/${this.totalRequests}, avg time: ${this.averageResponseTime}ms`);
  }
};
```

---

## üìö Roadmap —É–ª—É—á—à–µ–Ω–∏–π

### –§–∞–∑–∞ 1: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è (–°–ï–ô–ß–ê–°)
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚è≥ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 2: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–Ø–Ω–≤–∞—Ä—å)
- üí° –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –≤ YDB (–≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞)
- üí° –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (system prompt)
- üí° –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–µ–π (GigaChat vs GigaChat-Pro)
- üí° –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (temperature, max_tokens) –≤ UI

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–§–µ–≤—Ä–∞–ª—å)
- üîó –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (TTS) –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- üîó –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (STT) –¥–ª—è –≤–≤–æ–¥–∞
- üîó –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (RAG)
- üîó –≠–∫—Å–ø–æ—Ä—Ç –¥–∏–∞–ª–æ–≥–æ–≤ –≤ PDF

### –§–∞–∑–∞ 4: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è (–ú–∞—Ä—Ç)
- üí∞ –ü–æ–¥—Å—á—ë—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- üí∞ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –æ–ø–ª–∞—Ç—ã (Robokassa)
- üí∞ –õ–∏–º–∏—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- üí∞ Analytics dashboard

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Gigachat API - Overview](https://developers.sber.ru/docs/ru/gigachat/api/overview)
- [Gigachat API - Reference](https://developers.sber.ru/docs/ru/gigachat/api/reference/rest/gigachat-api)
- [–ú–æ–¥–µ–ª–∏ GigaChat](https://developers.sber.ru/docs/ru/gigachat/models)
- [–¢–∞—Ä–∏—Ñ—ã](https://developers.sber.ru/docs/ru/gigachat/api/tariffs)

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- [GigaChat OpenAI-compatible](https://developers.sber.ru/docs/ru/gigachat/guides/compatible-openai)
- [GigaChain (LangChain)](https://github.com/ai-forever/langchain-gigachat)
- [JS SDK](https://github.com/ai-forever/gigachat-js)

### –Ø–Ω–¥–µ–∫—Å –û–±–ª–∞–∫–æ
- [Yandex Cloud Functions - Node.js](https://cloud.yandex.com/en/docs/functions/lang/nodejs/)
- [YDB –≤ Cloud Functions](https://github.com/yandex-cloud-examples/yc-ydb-connect-from-serverless-function)
- [Cloud Logging](https://cloud.yandex.com/docs/logging/)

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Gigachat AI **—É–∂–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞** –Ω–∞ –æ–±–æ–∏—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö (Replit + Yandex Cloud). –û—Å–Ω–æ–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω—É–∂–Ω–æ —É–¥–µ–ª–∏—Ç—å:

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Å—ç–∫–æ–Ω–æ–º–∏—Ç 300+ –º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å
2. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ò—Å—Ç–æ—Ä–∏—è –≤ –ë–î –≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Yandex Cloud Logging

**–°—Ç–∞—Ç—É—Å:** üü¢ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**
