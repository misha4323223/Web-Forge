# üîê –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ Yandex Cloud

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ?
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/admin-login` –∏ `/api/verify-admin` –≤ Cloud Function
- JWT-–ø–æ–¥–æ–±–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å—é
- –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è)
- –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 24 —á–∞—Å–∞

## –®–∞–≥–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ Cloud Function
1. –û—Ç–∫—Ä–æ–π—Ç–µ **Yandex Cloud Console** ‚Üí **Cloud Functions**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `mp-webstudio-api` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é)
3. –ù–∞–∂–º–∏—Ç–µ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å**
4. –í —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–¥–∞ –∑–∞–º–µ–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `yandex-cloud-function/index-ydb.js` (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å YDB)
5. –ù–∞–∂–º–∏—Ç–µ **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Ä—Å–∏—é**

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–§—É–Ω–∫—Ü–∏—è —É–∂–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º:
- `ADMIN_EMAIL` - email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `ADMIN_PASSWORD` - –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏** ‚Üí **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:

```
ADMIN_EMAIL=Pimashin2015@gmail.com
ADMIN_PASSWORD=119944Alisa
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ –Ω–∞ https://www.mp-webstudio.ru/admin:

```
POST https://www.mp-webstudio.ru/api/admin-login?action=admin-login
{
  "email": "Pimashin2015@gmail.com",
  "password": "119944Alisa"
}
```

–û—Ç–≤–µ—Ç:
```json
{"success": true, "token": "..."}
```

–ò–ª–∏ —á–µ—Ä–µ–∑ curl:
```bash
curl -X POST 'https://functions.yandexcloud.net/YOUR_FUNCTION_ID?action=admin-login' \
  -H "Content-Type: application/json" \
  -d '{"email":"Pimashin2015@gmail.com","password":"119944Alisa"}'
```

### 4. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç
–û—Ç–∫—Ä–æ–π—Ç–µ https://www.mp-webstudio.ru/admin –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –≤–≤–µ–¥–∏—Ç–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?

```
–§—Ä–æ–Ω—Ç–µ–Ω–¥                      Cloud Function
   ‚îÇ                                ‚îÇ
   ‚îî‚îÄ‚îÄ‚Üí POST /admin-login ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
        (email, password)            ‚îÇ
                                    ‚îú‚îÄ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ credentials
                                    ‚îú‚îÄ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
                                    ‚îÇ
   ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ {token} ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚îÇ
   ‚îú‚îÄ‚Üí –°–æ—Ö—Ä–∞–Ω–∏—Ç—å token –≤ sessionStorage
   ‚îÇ
   ‚îî‚îÄ‚îÄ‚Üí POST /verify-admin ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
        (token)                     ‚îÇ
                                   ‚îú‚îÄ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
                                   ‚îú‚îÄ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏
                                   ‚îÇ
   ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ {valid: true/false} ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ì–¥–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ |
|------------|------------------|----------|------------|
| `ADMIN_EMAIL` | Cloud Function –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | ‚úÖ –î–ê |
| `ADMIN_PASSWORD` | Cloud Function –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | ‚úÖ –î–ê |
| `ADMIN_TOKEN_SECRET` | Cloud Function –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤ | ‚ùå –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ |

**–¢–µ–∫—É—â–∏–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- ADMIN_EMAIL: `Pimashin2015@gmail.com`
- ADMIN_PASSWORD: `119944Alisa`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç timing attacks (timingSafeEqual)
- HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–æ–≤
- –¢–æ–∫–µ–Ω—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ (24 —á–∞—Å–∞)
- SessionStorage –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ expiry –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (Replit)

–í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- `POST /api/admin-login`
- `POST /api/verify-admin`

–£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ Replit Secrets:
- `ADMIN_EMAIL`
- `ADMIN_PASSWORD`

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **405 Method Not Allowed** ‚Üí –§—É–Ω–∫—Ü–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞, –∑–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. **Invalid credentials** ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **CORS –æ—à–∏–±–∫–∞** ‚Üí –í Cloud Function —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
4. **–¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫** ‚Üí –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 24 —á–∞—Å–∞, –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –≤–æ–π—Ç–∏

## –ü–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è
‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- https://www.mp-webstudio.ru/admin
- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
