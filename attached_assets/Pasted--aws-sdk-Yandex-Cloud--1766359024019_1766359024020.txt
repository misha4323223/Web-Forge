–Ø –≤–∏–∂—É –æ—à–∏–±–∫—É! –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ aws-sdk –º–æ–¥—É–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ Yandex Cloud —Ñ—É–Ω–∫—Ü–∏–∏. –Ø –ø–µ—Ä–µ–¥–µ–ª–∞—é —Ñ—É–Ω–∫—Ü–∏—é loadKnowledgeBaseFromStorage() —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch API —Å AWS Signature V4 –≤–º–µ—Å—Ç–æ –≤–Ω–µ—à–Ω–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

–î–∞–≤–∞–π—Ç–µ —è –∏—Å–ø—Ä–∞–≤–ª—é —ç—Ç–æ –≤ yandex-cloud-function/index.js:

–Ø –∏—Å–ø—Ä–∞–≤–ª—é —Ñ—É–Ω–∫—Ü–∏—é loadKnowledgeBaseFromStorage() —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch API –≤–º–µ—Å—Ç–æ aws-sdk. –ü–µ—Ä–µ–¥–µ–ª–∞—é —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é —É–∂–µ –∏–º–µ—é—â—É—é—Å—è —Ñ—É–Ω–∫—Ü–∏—é signAwsRequest():

-22
+46
-22
+46
async function loadKnowledgeBaseFromStorage() {
    const now = Date.now();
    if (cachedKB && (now - cacheTime) < CACHE_TTL) {
        console.log('[KB] Using cached knowledge base');
        console.log('[KB] ‚úÖ Using cached knowledge base');
        return cachedKB;
    }
    try {
        console.log('[KB] Loading knowledge base from Object Storage...');
        const AWS = require('aws-sdk');
        const s3 = new AWS.S3({
            endpoint: 'https://storage.yandexcloud.net',
            accessKeyId: process.env.YC_ACCESS_KEY,
            secretAccessKey: process.env.YC_SECRET_KEY,
Perfect! –Ø –∏—Å–ø—Ä–∞–≤–∏–ª —Ñ—É–Ω–∫—Ü–∏—é loadKnowledgeBaseFromStorage(). –í–æ—Ç —á—Ç–æ —è –∏–∑–º–µ–Ω–∏–ª:

üéØ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ aws-sdk –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –Ω–∞ Yandex Cloud
‚ùå –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ –º–µ–∂–¥—É —Ñ—É–Ω–∫—Ü–∏—è–º–∏
–ú–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
1Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑—É—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch API –≤–º–µ—Å—Ç–æ aws-sdk

const kbResponse = await fetch(kbUrl, {
    method: 'GET',
    headers: {
        ...signatureHeaders,  // AWS Signature V4
        'Host': host,
    },
});
2Ô∏è‚É£ –†–∞–∑–¥–µ–ª–∏–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤!)

–§—É–Ω–∫—Ü–∏—è	–°—Ç–∞—Ä—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ	–ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
Knowledge Base	YC_ACCESS_KEY	KB_STORAGE_KEY
YC_SECRET_KEY	KB_STORAGE_SECRET
YC_BUCKET_NAME	KB_BUCKET_NAME
KB_OBJECT_PATH
3Ô∏è‚É£ –î–æ–±–∞–≤–∏–ª fallback + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

if (!kbStorageKey || !kbStorageSecret) {
    console.log('[KB] ‚ö†Ô∏è  KB_STORAGE_KEY or KB_STORAGE_SECRET not configured, skipping KB load');
    return null;
}
–ï—Å–ª–∏ KB –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚Üí GigaChat –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ KB –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚úÖ
–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ fails ‚Üí warning –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, GigaChat –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ‚úÖ
üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Yandex Cloud
–û–±–Ω–æ–≤–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ Yandex Cloud:

# ‚Üê –í–ú–ï–°–¢–û –≠–¢–û–ì–û:
YC_ACCESS_KEY = "..."
YC_SECRET_KEY = "..."
YC_BUCKET_NAME = "www.mp-webstudio.ru"
# ‚ûú –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –≠–¢–û:
KB_STORAGE_KEY = "your-s3-access-key"
KB_STORAGE_SECRET = "your-s3-secret-key"
KB_BUCKET_NAME = "mp-webstudio-kb"           # –ù–∞–∑–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞ –¥–ª—è KB
KB_OBJECT_PATH = "site-content.json"          # –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É KB
‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å:
GigaChat –∑–∞–ø—Ä–æ—Å:
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à KB
  ‚Üì
–ï—Å–ª–∏ –µ—Å—Ç—å KB_STORAGE_KEY/SECRET ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑ fetch + AWS Sig V4
  ‚Üì
–ï—Å–ª–∏ KB –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω ‚Üí –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ warning, continue –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  ‚Üì
GigaChat –¥–∞–µ—Ç –æ—Ç–≤–µ—Ç (—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –±–µ–∑)
  ‚Üì
–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç